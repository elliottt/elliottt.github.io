
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Debug Console on Xen - Stuff and Things</title>
  <meta name="author" content="Trevor Elliott">

  
  <meta name="description" content="When debugging HaLVM domains, the writeDebugConsole
function from Hypervisor.Debug is invaluable. However, in order to see the
messages printed, you &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://elliottt.github.io/blog/2015/03/04/debug-console-on-xen/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Stuff and Things" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Stuff and Things</a></h1>
  
    <h2>Probably just programming stuff</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:elliottt.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Debug Console on Xen</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-04T14:30:14-08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>When debugging <a href="http://halvm.org">HaLVM</a> domains, the <code>writeDebugConsole</code>
function from <code>Hypervisor.Debug</code> is invaluable.  However, in order to see the
messages printed, you must enable the emergency console in
<a href="http://xen.org">Xen</a>.  This isn&rsquo;t too difficult, but it&rsquo;s not terribly well
documented: there are many sources that describe parts of the process, but none
that describe the whole thing.</p>

<h2>Rebuilding Xen</h2>

<p>First, Xen must be rebuilt with the emergency console enabled.  This is a
relatively simple step, especially if you&rsquo;re building rpms.  When running
<code>make</code>, make sure to add the additional argument <code>verbose=y</code>, which enables the
emergency console.  If rebuilding an rpm, just modify the <code>make</code> invocation in
the <code>%build</code> section of the spec file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>make <span class="nv">verbose</span><span class="o">=</span>y
</span></code></pre></td></tr></table></div></figure>


<h2>Booting Xen</h2>

<p>Next, you will need to modify the command line passed to Xen on boot,
instructing it to output messages to the debug console.  When using grub2, on
Fedora, this is achieved by modifying the <code>/etc/default/grub</code> file, and
rebuilding the grub configuration.</p>

<p>First, append this line to <code>/etc/default/grub</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">GRUB_CMDLINE_XEN</span><span class="o">=</span><span class="s2">&quot;loglvl=all guest_loglvl=all sync_console console_to_ring&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This sets the logging level of both Xen and any guest domains to all, forces
synchronous output to the console, and copies all guest console output to the
console ring buffer.</p>

<p>Next, run this command to regenerate your grub config:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>sudo grub2-mkconfig -o /boot/grub2/grub.cfg
</span></code></pre></td></tr></table></div></figure>


<p>Now, you should be able to just reboot, selecting Xen from the grub menu, and be
able to see the output of calls to <code>writeDebugConsole</code>.</p>

<h2>Wrapping Up</h2>

<p>You should now be able to rebuild and configure Xen to allow guest domains to
write to the emergency console.  In particular, you can use this new feature to
aid the debugging of HaLVM domains.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Trevor Elliott</span></span>

      








  


<time datetime="2015-03-04T14:30:14-08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/xen/'>xen</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://elliottt.github.io/blog/2015/03/04/debug-console-on-xen/" data-via="" data-counturl="http://elliottt.github.io/blog/2015/03/04/debug-console-on-xen/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/05/17/private-dhcp/" title="Previous Post: Private DHCP">&laquo; Private DHCP</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/08/27/vim-find-file/" title="Next Post: Vim's `findfile` function">Vim's `findfile` function &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/08/27/vim-find-file/">Vim's `findfile` function</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/04/debug-console-on-xen/">Debug Console on Xen</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/17/private-dhcp/">Private DHCP</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/07/serenade-in-haskell/">Serenade in Haskell</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/22/vim-mapping-context/">Vim Mapping Context</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/elliottt">@elliottt</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'elliottt',
            count: 10,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Trevor Elliott -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
